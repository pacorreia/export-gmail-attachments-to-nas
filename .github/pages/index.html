<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Export Gmail attachments to a NAS server with filters and content checks." />
    <title>Export Gmail Attachments to NAS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="bg" aria-hidden="true">
      <div class="orb orb-a"></div>
      <div class="orb orb-b"></div>
      <div class="orb orb-c"></div>
    </div>

    <header class="site-header">
      <div class="container">
        <div class="brand">
          <div class="brand-mark">EG</div>
          <div>
            <div class="brand-title">Export Gmail Attachments</div>
            <div class="brand-sub">to NAS</div>
          </div>
        </div>
        <nav class="nav">
          <a href="#features">Features</a>
          <a href="#quickstart">Quick Start</a>
          <a href="#oauth">OAuth Setup</a>
          <a href="#config">Config</a>
          <a href="#convert">Convert</a>
          <a href="#security">Security</a>
          <a href="#contributors">Contributors</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero container">
        <div class="hero-text">
          <p class="eyebrow">Gmail + NAS automation</p>
          <h1>Save invoice and receipt attachments from Gmail to your NAS automatically.</h1>
          <p class="lead">
            A fast, focused Python tool to fetch matching emails, store attachments in structured folders,
            and optionally delete processed messages.
          </p>
          <div class="cta">
            <a class="btn primary" href="https://github.com/pacorreia/export-gmail-attachments-to-nas">View Repository</a>
            <a class="btn ghost" href="#quickstart">Get Started</a>
          </div>
          <div class="badges" aria-label="Project badges">
            <a href="https://github.com/pacorreia/export-gmail-attachments-to-nas/actions/workflows/ci.yml">
              <img alt="CI" src="https://github.com/pacorreia/export-gmail-attachments-to-nas/actions/workflows/ci.yml/badge.svg" />
            </a>
            <a href="https://github.com/pacorreia/export-gmail-attachments-to-nas/actions/workflows/bandit.yml">
              <img alt="Bandit Security" src="https://github.com/pacorreia/export-gmail-attachments-to-nas/actions/workflows/bandit.yml/badge.svg" />
            </a>
            <img alt="Code Coverage" src="https://img.shields.io/badge/Code%20Coverage-98%25-success?style=flat" />
            <img alt="License" src="https://img.shields.io/badge/License-MIT-2563eb" />
            <img alt="Last Commit" src="https://img.shields.io/github/last-commit/pacorreia/export-gmail-attachments-to-nas?color=2563eb" />
            <img alt="Issues" src="https://img.shields.io/github/issues/pacorreia/export-gmail-attachments-to-nas?color=2563eb" />
            <a class="badge-link" href="https://pypi.org/project/export-gmail-attachments-to-nas/">PyPI</a>
          </div>
        </div>
        <div class="hero-card">
          <div class="card-title">What it does</div>
          <ul>
            <li>Search Gmail with filters and queries</li>
            <li>Save attachments by sender and date</li>
            <li>Optional content filtering</li>
            <li>Convert attachments to txt, png, jpeg</li>
            <li>Reliable, retry-backed uploads</li>
          </ul>
          <div class="card-footer">
            <span>Python 3.12+</span>
            <span>SMB/NAS ready</span>
          </div>
        </div>
      </section>

      <section id="features" class="section container">
        <h2>Features</h2>
        <div class="grid">
          <article class="tile">
            <h3>Query-driven selection</h3>
            <p>Define Gmail queries and attachment filters per rule. Keep it narrow and precise.</p>
          </article>
          <article class="tile">
            <h3>Structured storage</h3>
            <p>Attachments are saved by sender and date, making retrieval predictable.</p>
          </article>
          <article class="tile">
            <h3>Content filters</h3>
            <p>Scan PDF or text attachments for required phrases before saving.</p>
          </article>
          <article class="tile">
            <h3>Attachment conversion</h3>
            <p>Automatically convert saved PDFs to txt, png, or jpeg in a separate output folder.</p>
          </article>
          <article class="tile">
            <h3>Operational safety</h3>
            <p>Retries, logging, and optional delete-after-save keep runs clean.</p>
          </article>
        </div>
      </section>

      <section id="quickstart" class="section container">
        <h2>Quick Start</h2>
        <div class="code-panel">
          <pre><code>pip install -r requirements.txt
python -m build
pip install .

export-gmail-attachments-to-nas \
  --username YOUR_NAS_USER \
  --password YOUR_NAS_PASSWORD \
  --credentials /path/to/credentials.json \
  --criteria /path/to/criteria.json</code></pre>
        </div>
      </section>

      <section id="config" class="section container">
        <h2>Criteria Configuration</h2>
        <p>Create a <code>criteria.json</code> file to define your email processing rules. Each entry in <code>criteria</code> is evaluated independently.</p>
        <div class="code-panel">
          <pre><code>{
  "smb_server": "homenas.home.lan",
  "criteria": [
    {
      "enabled": true,
      "query": "{subject:Invoice subject:Receipt} filename:.pdf",
      "smb_folder": "\\documents\\invoices",
      "filters": [".pdf"],
      "attachment_content_filter": ["Invoice", "Total"],
      "delete_after_save": false,
      "convert": {
        "to": "txt",
        "output_folder": "\\documents\\invoices-txt",
        "extension_filter": [".pdf"],
        "filename_filter": "invoice.*"
      }
    }
  ]
}</code></pre>
        </div>

        <h3>Criteria fields</h3>
        <div class="table-wrapper">
          <table class="field-table">
            <thead>
              <tr><th>Field</th><th>Required</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>enabled</code></td><td>❌</td><td>Set to <code>false</code> to skip this rule. Defaults to <code>true</code>.</td></tr>
              <tr><td><code>query</code></td><td>✅</td><td>Gmail search query (supports all Gmail search operators).</td></tr>
              <tr><td><code>smb_folder</code></td><td>✅</td><td>Destination folder on the SMB share.</td></tr>
              <tr><td><code>filters</code></td><td>✅</td><td>List of file extensions to save (e.g. <code>[".pdf"]</code>).</td></tr>
              <tr><td><code>attachment_content_filter</code></td><td>❌</td><td>Save only if the attachment contains at least one of these phrases.</td></tr>
              <tr><td><code>delete_after_save</code></td><td>❌</td><td>Delete the source email after a successful save. Defaults to <code>false</code>.</td></tr>
              <tr><td><code>convert</code></td><td>❌</td><td>Optional block to convert attachments. See <a href="#convert">Convert</a> section.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="convert" class="section container">
        <h2>Attachment Conversion</h2>
        <p>
          Each rule can include a <code>convert</code> block to automatically convert saved attachments to another format
          and store the result in a separate output folder. Omitting it leaves the rule's behaviour unchanged.
        </p>

        <h3>Supported conversions</h3>
        <ul style="color:var(--muted);line-height:1.9;padding-left:20px">
          <li>PDF → <code>txt</code> — full text extraction</li>
          <li>PDF → <code>png</code> — one image per page</li>
          <li>PDF → <code>jpeg</code> / <code>jpg</code> — one image per page</li>
        </ul>

        <div class="code-panel" style="margin-top:16px">
          <pre><code>"convert": {
  "to": "txt",
  "output_folder": "\\documents\\converted",
  "extension_filter": [".pdf"],
  "filename_filter": "invoice.*"
}</code></pre>
        </div>

        <h3 style="margin-top:32px">Convert fields</h3>
        <div class="table-wrapper">
          <table class="field-table">
            <thead>
              <tr><th>Field</th><th>Required</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>to</code></td><td>✅</td><td>Target format: <code>txt</code>, <code>png</code>, <code>jpeg</code>, or <code>jpg</code>.</td></tr>
              <tr><td><code>output_folder</code></td><td>✅</td><td>SMB folder path where converted files are saved.</td></tr>
              <tr><td><code>extension_filter</code></td><td>❌</td><td>Restrict conversion to attachments with these extensions (e.g. <code>[".pdf"]</code>).</td></tr>
              <tr><td><code>filename_filter</code></td><td>❌</td><td>Restrict conversion to filenames matching this regex (case-insensitive).</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="oauth" class="section container">
        <h2>Google OAuth Setup</h2>
        <p>This tool requires Google OAuth credentials to access Gmail. Follow these steps to create them:</p>
        
        <div class="setup-steps">
          <div class="step">
            <h3>1. Create a Google Cloud Project</h3>
            <ol>
              <li>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
              <li>Click <strong>Select a Project</strong> → <strong>New Project</strong></li>
              <li>Enter a project name (e.g., "Gmail Attachments Export")</li>
              <li>Click <strong>Create</strong> and wait for the project to initialize</li>
            </ol>
          </div>

          <div class="step">
            <h3>2. Enable Gmail API</h3>
            <ol>
              <li>In the Cloud Console, navigate to <strong>APIs &amp; Services</strong> → <strong>Library</strong></li>
              <li>Search for "Gmail API"</li>
              <li>Click the Gmail API result</li>
              <li>Click <strong>Enable</strong></li>
            </ol>
          </div>

          <div class="step">
            <h3>3. Create OAuth 2.0 Credentials</h3>
            <ol>
              <li>Go to <strong>APIs &amp; Services</strong> → <strong>Credentials</strong></li>
              <li>Click <strong>+ Create Credentials</strong> → <strong>OAuth client ID</strong></li>
              <li>If prompted, configure the OAuth consent screen first:
                <ul>
                  <li>Choose <strong>External</strong> user type</li>
                  <li>Fill in the required fields (app name, user support email)</li>
                  <li>Under scopes, add <code>https://mail.google.com/</code></li>
                  <li>Save and continue</li>
                </ul>
              </li>
              <li>Back to credentials, select <strong>Desktop application</strong> as the application type</li>
              <li>Click <strong>Create</strong></li>
            </ol>
          </div>

          <div class="step">
            <h3>4. Download Credentials</h3>
            <ol>
              <li>In the Credentials page, find your newly created OAuth 2.0 Client ID</li>
              <li>Click the download icon (↓) to download the JSON file</li>
              <li>Save it as <code>credentials.json</code> in your project directory</li>
            </ol>
          </div>

          <div class="step">
            <h3>5. First Run Authentication</h3>
            <ol>
              <li>Run the tool for the first time with your credentials</li>
              <li>A browser window will open asking for Gmail access</li>
              <li>Click <strong>Allow</strong> to grant permissions</li>
              <li>The tool will create <code>token.json</code> automatically</li>
              <li>Keep both files secure and don't commit them to version control</li>
            </ol>
          </div>
        </div>
      </section>

      <section id="security" class="section container">
        <h2>Security Notes</h2>
        <div class="grid">
          <article class="tile">
            <h3>Credentials</h3>
            <p>Store NAS credentials in env vars or pass them at runtime.</p>
          </article>
          <article class="tile">
            <h3>Token hygiene</h3>
            <p>Gmail tokens are stored locally in token.json. Treat it as sensitive.</p>
          </article>
          <article class="tile">
            <h3>Scope control</h3>
            <p>Use minimal required Gmail scope. Delete requires mail.google.com.</p>
          </article>
          <article class="tile">
            <h3>NAS access</h3>
            <p>Limit SMB share permissions to a dedicated account when possible.</p>
          </article>
        </div>
      </section>

      <section id="contributors" class="section container">
        <h2>Contributors</h2>
        <p>Thanks to all the amazing people who have contributed to this project!</p>
        <div id="contributors-list" class="contributors-grid">
          <div class="loading">Loading contributors...</div>
        </div>
      </section>
    </main>

    <script>
      // Fetch contributors from GitHub API
      fetch('https://api.github.com/repos/pacorreia/export-gmail-attachments-to-nas/contributors')
        .then(response => response.json())
        .then(contributors => {
          const container = document.getElementById('contributors-list');
          container.innerHTML = contributors.map(contributor => `
            <a href="${contributor.html_url}" class="contributor" target="_blank" rel="noopener">
              <img src="${contributor.avatar_url}" alt="${contributor.login}" />
              <div class="contributor-name">${contributor.login}</div>
              <div class="contributor-contributions">${contributor.contributions} contributions</div>
            </a>
          `).join('');
        })
        .catch(error => {
          console.error('Error fetching contributors:', error);
          document.getElementById('contributors-list').innerHTML = '<p>Unable to load contributors.</p>';
        });
    </script>

    <footer class="site-footer">
      <div class="container footer-grid">
        <div>
          <div class="brand-title">Export Gmail Attachments to NAS</div>
          <p>Built for fast, reliable attachment routing.</p>
        </div>
        <div class="footer-links">
          <a href="https://github.com/pacorreia/export-gmail-attachments-to-nas">GitHub</a>
          <a href="https://github.com/pacorreia/export-gmail-attachments-to-nas/issues">Issues</a>
          <a href="https://github.com/pacorreia/export-gmail-attachments-to-nas/releases">Releases</a>
          <a href="https://pypi.org/project/export-gmail-attachments-to-nas/">PyPI</a>
        </div>
      </div>
    </footer>
  </body>
</html>